---
layout:     post
title:      BIO,NIO,AIO复习
subtitle:   概述
date:       2021-02-22
author:     QuanLi
header-img: img/post-bg-kuaidi.jpg
catalog: true
tags:
    - JavaSE
---

# BIO,NIO,AIO复习

​	BIO,NIO,AIO可以理解为java语言对操作系统各种IO模型的封装

### 同步、异步、阻塞、非阻塞的区别

**阻塞和非阻塞常用于形容多线程之间的影响，同步和异步通常形容一次方法调用；**

**同步和异步**

- 同步：发送一个请求，等待返回，再发送下一个请求
- 异步：发送一个请求，不等待返回，随时可以再发送下一个请求

**阻塞和非阻塞**

- 阻塞 : 阻塞就是发起一个请求，调用者一直等待请求结果返回，也就是当前线程会被挂起，无法从事其他任务。传统的IO流都是阻塞式的。也就是说，当一个线程调用read()或者write()方法时，该线程将被阻塞，在此期间，该线程不能执行其他任何任务。
- 非阻塞：发起一个请求调用者不用一直等待结果返回，可以做其他事。JavaNIO是非阻塞式的。当线程从某通道进行读写数据时，该线程会去执行其他任务。线程通常将非阻塞IO的空闲时间用于在其他通道上执行IO操作，所以单独的线程可以管理多个输入和输出通道。因此NIO可以让服务器端使用一个或有限几个线程来同时处理连接到服务器端的所有客户端。



### BIO（Blocking I/O)

特点：

- 同步阻塞IO模式，**数据的读取和写入必须阻塞在一个线程内等待其**完成。**一请求一应答通信模型**。
- 如果要处理多个客户端请求，就必须使用多线程。线程创建销毁成本很高，可以用线程池降低创建和回收成本。
- 在活动连接数不是很高（小于单机1000）情况下，这种模型是不错的。、

弊端：

- 这种模式服务器处理请求之所以**慢是因为服务器线程在等待IO**，让高速运转的CPU去等待及其低效的网络IO是非常不合算，为了将网络IO的等待时间从线程之中分离出来，出现了NIO

### NIO(New I/O)

​	**NIO是面向缓冲、基于通道的。**使用NIO可以将将BIO网络IO等待时间从业务线程中抽取出来。

##### NIO如何工作

NIO的关键组件是**channel(通道)、buffer(缓冲区)、selector(选择器)**

- **buffer(缓冲区)**：IO面向流，而NIO面向缓冲区，读取数据时直接读到缓冲区，写入数据也直接写入缓冲区。

缓冲区实质上是一个数组，通常它是一个字节数组（ByteBuffer），也可以使用其他类的数组。每一种Java基本类型（除了Boolean）都对应一种缓冲区。

- **channel(通道)** ：一个channel可以和文件或者套接字对应，可以通过它来读取和写入数据。通道是双向的，流是单向的，通道只和缓冲区交互，因为缓冲区的存在通道可以实现非阻塞。
- **selector(选择器)** ： Selector选择器可以监听多个Channel通道感兴趣的事情(read、write、accept(服务端接收)、connect，**实现一个线程管理多个Channel**，节省线程切换上下文的资源消耗。

##### 特点

- 同步非阻塞模式。支持面向缓冲，基于通道的I/O操作方法
- I/O面向流，NIO面向缓冲区，NIO直接读到缓冲区中进行操作
- NIO通过channel通道进行读写，通道是双向的可读可写，而流的读写是单向的。无论读写只能和Buffer交互
- 但是JDK原生NIO编程复杂，还会出现很多bug，Netty的出现改善了原生NIO存在的问题

##### 应用

特别是Netty是目前最流行的一个Java开源框架NIO框架，Netty提供异步的、事件驱动的网络应用程序框架和工具，用以快速开发高性能、高可靠性的网络服务器和客户端程序。相比JDK原生NIO，Netty提供了相对十分简单易用的API，非常适合网络编程。

### AIO（Asynchronous I/O)

AIO是异步IO的缩写，虽然在NIO提供了非阻塞方法，但是NIO的IO行为还是同步的。对于NIO来说，业务线程在IO准备好时得到通知，接着由这个线程自行进行IO操作，本身还是同步的。

AIO更进了一步，它不是在IO准备好时通知线程，而是在IO操作已经完成后在发出通知，业务逻辑变成了一个回调函数，等IO操作完成后系统自动触发。

##### **异步非阻塞与同步非阻塞的区别在哪里？**

异步非阻塞无需一个线程去轮询所有IO操作的状态改变，**在相应的状态改变后，系统会通知对应的线程来处理。**对应到烧开水中就是，为每个水壶上面装了一个开关，水烧开之后，水壶会自动通知我水烧开了。

### **BIO、NIO、AIO适用场景**

- BIO方式适用于连接数目比较小且固定的架构，这种方式对服务器资源要求比较高，并发局限于应用中，JDK1.4以前的唯一选择。
- NIO方式适用于连接数目多且连接比较短（轻操作）的架构，比如聊天服务器，并发局限于应用中，编程比较复杂。
- AIO方式使用于连接数目多且连接比较长（重操作）的架构，比如相册服务器，充分调用OS参与并发操作，编程比较复杂，JDK7开始支持。